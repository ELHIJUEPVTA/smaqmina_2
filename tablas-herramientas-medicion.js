let herramientas3 = JSON.parse(localStorage.getItem("herramientas3")) || [];
let tabla = document.getElementById("tabladatos");
const usuarioActivo = localStorage.getItem("usuarioActivo");
let accion=document.getElementById("accion")
function guardar(){
    localStorage.setItem("herramientas3", JSON.stringify(herramientas3));
}
function cargarTabla(){

    tabla.innerHTML = "";

    for(let i = 0; i < herramientas3.length; i++){

        let fila = tabla.insertRow();

        fila.insertCell(0).innerText = i + 1;

        let nombreCell = fila.insertCell(1);
        nombreCell.innerText = herramientas3[i].nombre;

        let cantidadCell = fila.insertCell(2);
        cantidadCell.innerText = herramientas3[i].bueno;

        let celdaEstado = fila.insertCell(3);

        let select = document.createElement("select");
        let estados = ["Bueno", "Regular", "Malo"];

        estados.forEach(function(estado){// la variable estados se va ahora almacenar en la funcion donde dice estado y se puede verificar la opcion que en el formato se selcciono
            let option = document.createElement("option");
            option.text = estado;
            select.add(option);
        });

        select.addEventListener("change", function(){

            if(select.value === "Bueno"){
                cantidadCell.innerText = herramientas3[i].bueno;
            }
            if(select.value === "Regular"){
                cantidadCell.innerText = herramientas3[i].regular;
            }
            if(select.value === "Malo"){
                cantidadCell.innerText = herramientas3[i].malo;
            }
        });
        celdaEstado.appendChild(select);
        if(usuarioActivo){
        let celdaAccion = fila.insertCell(4);
        let botonModificar = document.createElement("button");
        botonModificar.innerText = "âœï¸";
        botonModificar.style.backgroundColor="white";
        botonModificar.addEventListener("click", function(){
            let nuevoNombre = prompt("Nuevo nombre:", herramientas3[i].nombre);
            let nuevoBueno = prompt("Cantidad Bueno:", herramientas3[i].bueno);
            let nuevoRegular = prompt("Cantidad Regular:", herramientas3[i].regular);
            let nuevoMalo = prompt("Cantidad Malo:", herramientas3[i].malo);
            if(nuevoNombre !== null){
                herramientas3[i].nombre = nuevoNombre;
                herramientas3[i].bueno = parseInt(nuevoBueno) || 0;
                herramientas3[i].regular = parseInt(nuevoRegular) || 0;
                herramientas3[i].malo = parseInt(nuevoMalo) || 0;
            }
            guardar();
            cargarTabla();
        });
        celdaAccion.appendChild(botonModificar); 
        let botonEliminar = document.createElement("button");
        botonEliminar.innerText = "ðŸ—‘ï¸";
        botonEliminar.style.backgroundColor = "white";
        botonEliminar.addEventListener("click", function(){
            herramientas3.splice(i, 1);
            guardar();
            cargarTabla();
        });
        celdaAccion.appendChild(botonEliminar);
    }
    else{
        accion.style.display="none"
    }
    }
}
cargarTabla();
let menu = document.getElementById("menuAccesibilidad");
let boton = document.getElementById("botonAccesibilidad");

/* Abrir / cerrar menÃº */
boton.addEventListener("click", () => {
    menu.style.display = menu.style.display === "flex" ? "none" : "flex";
});

/* FUNCIONES */

function toggleOscuro(){
    document.body.classList.toggle("dark-mode");
    guardarConfig();
}

function toggleContraste(){
    document.body.classList.toggle("alto-contraste");
    guardarConfig();
}


function mayusculas(){
    document.body.classList.toggle("mayusculas");
    guardarConfig();
}

function resetEstilos(){
    document.body.classList.remove("dark-mode", "alto-contraste", "mayusculas");
    localStorage.removeItem("configAccesibilidad");
}
function leerPagina(){
    if (speechSynthesis.speaking) return;

    let texto = document.body.innerText;
    vozActiva = new SpeechSynthesisUtterance(texto);

    speechSynthesis.speak(vozActiva);
}
function detenerLectura() {
    speechSynthesis.cancel();
}
/* GUARDAR CONFIGURACIÃ“N */

function guardarConfig(){
    localStorage.setItem("configAccesibilidad", JSON.stringify({
        oscuro: document.body.classList.contains("dark-mode"),
        contraste: document.body.classList.contains("alto-contraste"),
        mayuscula: document.body.classList.contains("mayusculas"),
    }));
}

/* CARGAR CONFIGURACIÃ“N */

window.onload = function(){
    let config = JSON.parse(localStorage.getItem("configAccesibilidad"));

    if(config){
        if(config.oscuro) document.body.classList.add("dark-mode");
        if(config.contraste) document.body.classList.add("alto-contraste");
        if(config.mayuscula) document.body.classList.add("mayusculas");
    }
}

